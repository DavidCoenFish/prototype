<!DOCTYPE html>
<html>
	<head>
		<style type="text/css" media="screen">
			html, body { margin:0; padding:0; overflow:hidden; background: #000000; }
		</style>
			<!-- svg { position:fixed; top:0; left:0; height:100%; width:100%; background: #00ff00;} -->

		<script type="text/javascript">

var factory = function factory(in_document, in_canvasStyleDictionaryOrUndefined) {
	var m_element = in_document.createElement("CANVAS");

	if (undefined !== in_canvasStyleDictionaryOrUndefined) {
	for (var key in in_canvasStyleDictionaryOrUndefined) {
		if (in_canvasStyleDictionaryOrUndefined.hasOwnProperty(key)) {
		m_element.style[key] = in_canvasStyleDictionaryOrUndefined[key];
		}
	}
	}

	var that = Object.create({
	"getElement": function getElement() {
		return m_element;
	}
	});
	return that;
};
var factoryAppendBody = function factoryAppendBody(in_document, in_canvasStyleDictionaryOrUndefined) {
	var result = factory(in_document, in_canvasStyleDictionaryOrUndefined);
	var element = result.getElement();
	in_document.body.appendChild(element);
	element.width = element.offsetWidth;
	element.height = element.offsetHeight;
	return result;
};

var cmpAlmost = function cmpAlmost(in_lhs, in_rhs, in_epsilonOrUndefined) {
	var epsilon = undefined === in_epsilonOrUndefined ? Number.MIN_VALUE : in_epsilonOrUndefined;
	var result = Math.abs(in_lhs - in_rhs) <= epsilon;
	return result;
};

var factory$1 = function factory(in_red, in_green, in_blue, in_alpha, in_baseArrayClass) {
	var data = new in_baseArrayClass([in_red, in_green, in_blue, in_alpha]);
	var that = Object.create({
	"getRed": function getRed() {
		return data[0];
	},
	"getGreen": function getGreen() {
		return data[1];
	},
	"getBlue": function getBlue() {
		return data[2];
	},
	"getAlpha": function getAlpha() {
		return data[3];
	},
	"setRed": function setRed(in_value) {
		data[0] = in_value;
		return;
	},
	"setGreen": function setGreen(in_value) {
		data[1] = in_value;
		return;
	},
	"setBlue": function setBlue(in_value) {
		data[2] = in_value;
		return;
	},
	"setAlpha": function setAlpha(in_value) {
		data[3] = in_value;
		return;
	},
	"getRaw": function getRaw() {
		return data;
	},
	"getRawClass": function getRawClass() {
		return in_baseArrayClass;
	}
	});
	return that;
};
var factoryFloat32 = function factoryFloat32(in_redOrUndefined, in_greenOrUndefined, in_blueOrUndefined, in_alphaOrUndefined) {
	var red = undefined === in_redOrUndefined ? 0.0 : in_redOrUndefined;
	var green = undefined === in_greenOrUndefined ? 0.0 : in_greenOrUndefined;
	var blue = undefined === in_blueOrUndefined ? 0.0 : in_blueOrUndefined;
	var alpha = undefined === in_alphaOrUndefined ? 0.0 : in_alphaOrUndefined;
	return factory$1(red, green, blue, alpha, Float32Array);
};
var cmpAlmost$1 = function cmpAlmost$1(in_lhs, in_rhs, in_epsilonOrUndefined) {
	var dataLhs = in_lhs.getRaw();
	var dataRhs = in_rhs.getRaw();
	return true === cmpAlmost(dataLhs[0], dataRhs[0], in_epsilonOrUndefined) && true === cmpAlmost(dataLhs[1], dataRhs[1], in_epsilonOrUndefined) && true === cmpAlmost(dataLhs[2], dataRhs[2], in_epsilonOrUndefined) && true === cmpAlmost(dataLhs[3], dataRhs[3], in_epsilonOrUndefined);
};

function EventDispatcherDecorate (in_targetObject) {
	var eventMap = {};
	Object.assign(in_targetObject, {
	"addEventListener": function addEventListener(in_name, in_callback) {
		if (in_name in eventMap) {
		eventMap[in_name].push(in_callback);
		} else {
		eventMap[in_name] = [in_callback];
		}

		return;
	},
	"removeEventListener": function removeEventListener(in_name, in_callback) {
		if (in_name in eventMap) {
		var dataArray = eventMap[in_name];
		var index = dataArray.indexOf(in_callback);

		if (-1 < index) {
			dataArray.splice(index, 1);
		}
		}

		return;
	},
	"triggerEvent": function triggerEvent(in_name) {
		if (in_name in eventMap) {
		var param = Array.prototype.slice.call(arguments, 1);
		var dataArray = eventMap[in_name];
		dataArray.forEach(function (in_element) {
			in_element.apply(in_element, param);
		});
		}

		return;
	}
	});
}

var getWebGLContext = function getWebGLContext(in_html5CanvasElement, in_paramObjectOrUndefined) {
	if (undefined === in_html5CanvasElement) {
	throw "Canvas element not found";
	}

	if (!window.WebGLRenderingContext) {
	throw "Webgl not supported";
	}

	var webGLContext = in_html5CanvasElement.getContext("webgl", in_paramObjectOrUndefined);

	if (undefined === webGLContext) {
	webGLContext = in_html5CanvasElement.getContext("experimental-webgl", in_paramObjectOrUndefined);
	}

	if (undefined === webGLContext) {
	throw "Unable to get webgl Context";
	}

	if (undefined === webGLContext) {
	throw "Unable to get webgl Context";
	}

	if (undefined !== in_paramObjectOrUndefined && undefined !== in_paramObjectOrUndefined.extentions) {
	for (var index = 0; index < in_paramObjectOrUndefined.extentions.length; index++) {
		var extentionName = in_paramObjectOrUndefined.extentions[index];
		var extention = webGLContext.getExtension(extentionName);

		if (null === extention) {
		throw "failed to get extention:" + extentionName;
		}
	}
	}

	return webGLContext;
};

var sTokenWebglContextLost = "webglcontextlost";
var sTokenWebglContextRestored = "webglcontextrestored";

var makeParam = function makeParam(in_alphaOrUndefined, in_depthOrUndefined, in_antialiasOrUndefined, in_extentionsOrUndefined, in_preserveDrawingBufferOrUndefined) {
	var param = undefined;

	if (undefined !== in_alphaOrUndefined) {
	if (undefined === param) {
		param = {};
	}

	param["alpha"] = in_alphaOrUndefined;
	}

	if (undefined !== in_depthOrUndefined) {
	if (undefined === param) {
		param = {};
	}

	param["depth"] = in_depthOrUndefined;
	}

	if (undefined !== in_antialiasOrUndefined) {
	if (undefined === param) {
		param = {};
	}

	param["antialias"] = in_antialiasOrUndefined;
	}

	if (undefined !== in_extentionsOrUndefined) {
	if (undefined === param) {
		param = {};
	}

	param["extentions"] = in_extentionsOrUndefined;
	}

	if (undefined !== in_preserveDrawingBufferOrUndefined) {
	if (undefined === param) {
		param = {};
	}

	param["preserveDrawingBuffer"] = in_preserveDrawingBufferOrUndefined;
	}

	return param;
};

function WebGLContextWrapper (in_html5CanvasElement, in_alphaOrUndefined, in_depthOrUndefined, in_antialiasOrUndefined, in_extentionsOrUndefined, in_preserveDrawingBufferOrUndefined) {
	var m_webGLContext = getWebGLContext(in_html5CanvasElement, makeParam(in_alphaOrUndefined, in_depthOrUndefined, in_antialiasOrUndefined, in_extentionsOrUndefined, in_preserveDrawingBufferOrUndefined));

	var getError = function getError() {
	if (undefined === m_webGLContext) {
		return;
	}

	var error = m_webGLContext.getError();
	var assert = true;
	var message;

	switch (error) {
		default:
		message = "WebGLContetWrapper.GetError:unknown:" + error;
		break;

		case m_webGLContext.NO_ERROR:
		return;

		case m_webGLContext.INVALID_ENUM:
		message = "WebGLContetWrapper.GetError:INVALID_ENUM";
		break;

		case m_webGLContext.INVALID_VALUE:
		message = "WebGLContetWrapper.GetError:INVALID_VALUE";
		break;

		case m_webGLContext.INVALID_OPERATION:
		message = "WebGLContetWrapper.GetError:INVALID_OPERATION";
		break;

		case m_webGLContext.OUT_OF_MEMORY:
		message = "WebGLContetWrapper.GetError:OUT_OF_MEMORY";
		break;

		case m_webGLContext.CONTEXT_LOST_WEBGL:
		assert = false;
		message = "WebGLContetWrapper.GetError:CONTEXT_LOST_WEBGL";
		return;
	}

	m_webGLContext = undefined;
	console.info(message);

	if (true === assert) {
		alert(message);
	}

	return;
	};

	var contextLostCallback = function contextLostCallback(in_event) {
	in_event.preventDefault();
	m_webGLContext = undefined;
	that.triggerEvent(sTokenWebglContextLost, that);
	};

	var contextRestoredCallback = function contextRestoredCallback(in_event) {
	m_webGLContext = undefined;
	m_webGLContext = getWebGLContext(in_html5CanvasElement, in_param);
	that.triggerEvent(sTokenWebglContextRestored, that);
	};

	var that = Object.create({
	"getParameter": function getParameter(in_enum) {
		if (undefined === m_webGLContext) {
		return undefined;
		}

		var parameter = m_webGLContext.getParameter(in_enum);
		getError();
		return parameter;
	},
	"getSupportedExtensions": function getSupportedExtensions() {
		if (undefined === m_webGLContext) {
		return undefined;
		}

		var supportedExtensions = m_webGLContext.getSupportedExtensions();
		getError();
		return supportedExtensions;
	},
	"getEnum": function getEnum(in_keySoftBind) {
		if (undefined === m_webGLContext) {
		return undefined;
		}

		var value = m_webGLContext[in_keySoftBind];
		return value;
	},
	"callMethod": function callMethod(in_functionName) {
		var output = undefined;

		if (undefined !== m_webGLContext) {
		var method = m_webGLContext[in_functionName];

		if (undefined === method) {
			console.log("callMethod failed to find:" + in_functionName);
			return output;
		}

		var param = Array.prototype.slice.call(arguments, 1);
		output = method.apply(m_webGLContext, param);
		getError();
		}

		return output;
	},
	"addResourceContextCallbacks": function addResourceContextCallbacks(in_contextRestoredCallback, in_contextLostCallback) {
		that.addEventListener(sTokenWebglContextLost, in_contextLostCallback);
		that.addEventListener(sTokenWebglContextRestored, in_contextRestoredCallback);

		if (m_webGLContext !== undefined) {
		in_contextRestoredCallback(that);
		}
	},
	"removeResourceContextCallbacks": function removeResourceContextCallbacks(in_contextRestoredCallback, in_contextLostCallback) {
		if (m_webGLContext === undefined) {
		in_contextLostCallback(that);
		}

		that.removeEventListener(sTokenWebglContextLost, in_contextLostCallback);
		that.removeEventListener(sTokenWebglContextRestored, in_contextRestoredCallback);
	},
	"getCanvasWidth": function getCanvasWidth() {
		return in_html5CanvasElement.width;
	},
	"getCanvasHeight": function getCanvasHeight() {
		return in_html5CanvasElement.height;
	}
	});
	EventDispatcherDecorate(that);
	in_html5CanvasElement["addEventListener"]("webglcontextlost", contextLostCallback, false);
	in_html5CanvasElement["addEventListener"]("webglcontextrestored", contextRestoredCallback, false);
	return that;
}

var VectorPrototype = {
	"dotProduct": function dotProduct(in_vector) {
	var dataLhs = this.getRaw();
	var dataRhs = in_vector.getRaw();
	var result = 0;
	var count = Math.min(dataLhs.length, dataRhs.length);

	for (var index = 0; index < count; ++index) {
		result += dataLhs[index] * dataRhs[index];
	}

	return result;
	},
	"length": function length() {
	var data = this.getRaw();
	var sum = 0;

	for (var index = 0; index < data.length; ++index) {
		sum += data[index] * data[index];
	}

	var length = Math.sqrt(sum);
	return length;
	},
	"normaliseSelf": function normaliseSelf() {
	var data = this.getRaw();
	var length = this.length();

	if (0.0 !== length) {
		var mul = 1.0 / length;

		for (var index = 0; index < data.length; ++index) {
		data[index] *= mul;
		}
	}

	return length;
	}
};

var factory$2 = function factory(in_x, in_y, in_z, in_w, in_baseArrayClass) {
	var data = new in_baseArrayClass([in_x, in_y, in_z, in_w]);
	var that = Object.create({
	"getX": function getX() {
		return data[0];
	},
	"getY": function getY() {
		return data[1];
	},
	"getZ": function getZ() {
		return data[2];
	},
	"getW": function getW() {
		return data[3];
	},
	"setX": function setX(in_value) {
		data[0] = in_value;
		return;
	},
	"setY": function setY(in_value) {
		data[1] = in_value;
		return;
	},
	"setZ": function setZ(in_value) {
		data[2] = in_value;
		return;
	},
	"setW": function setW(in_value) {
		data[3] = in_value;
		return;
	},
	"set": function set(in_vector4) {
		data[0] = in_vector4.getX();
		data[1] = in_vector4.getY();
		data[2] = in_vector4.getZ();
		data[3] = in_vector4.getW();
		return;
	},
	"getRaw": function getRaw() {
		return data;
	},
	"getRawClass": function getRawClass() {
		return in_baseArrayClass;
	}
	});
	Object.assign(that, VectorPrototype);
	return that;
};
var factoryInt32 = function factoryInt32(in_xOrUndefined, in_yOrUndefined, in_zOrUndefined, in_wOrUndefined, in_vector4OrUndefined) {
	var x = undefined === in_xOrUndefined ? 0.0 : in_xOrUndefined;
	var y = undefined === in_yOrUndefined ? 0.0 : in_yOrUndefined;
	var z = undefined === in_zOrUndefined ? 0.0 : in_zOrUndefined;
	var w = undefined === in_wOrUndefined ? 0.0 : in_wOrUndefined;

	if (undefined !== in_vector4OrUndefined) {
	in_vector4OrUndefined.setX(x);
	in_vector4OrUndefined.setY(y);
	in_vector4OrUndefined.setZ(z);
	in_vector4OrUndefined.setW(w);
	return in_vector4OrUndefined;
	}

	return factory$2(x, y, z, w, Int32Array);
};
var cmpAlmost$2 = function cmpAlmost$1(in_lhs, in_rhs, in_epsilonOrUndefined) {
	var dataLhs = in_lhs.getRaw();
	var dataRhs = in_rhs.getRaw();
	return true === cmpAlmost(dataLhs[0], dataRhs[0], in_epsilonOrUndefined) && true === cmpAlmost(dataLhs[1], dataRhs[1], in_epsilonOrUndefined) && true === cmpAlmost(dataLhs[2], dataRhs[2], in_epsilonOrUndefined) && true === cmpAlmost(dataLhs[3], dataRhs[3], in_epsilonOrUndefined);
};

var sTextureStateName = [];

for (var index = 0; index < 128; ++index) {
	sTextureStateName.push("TEXTURE" + index);
}

function WebGLStateFactory (in_html5CanvasElement, in_alphaOrUndefined, in_depthOrUndefined, in_antialiasOrUndefined, in_extentionsOrUndefined, in_preserveDrawingBufferOrUndefined) {
	var m_webGLContextWrapper = WebGLContextWrapper(in_html5CanvasElement, in_alphaOrUndefined, in_depthOrUndefined, in_antialiasOrUndefined, in_extentionsOrUndefined, in_preserveDrawingBufferOrUndefined);
	var m_state = {};
	var m_lastShaderMapVertexAttribute = {};

	var stateValueCmp = function stateValueCmp(in_valueName, in_value) {
	if (in_valueName in m_state && in_value === m_state[in_valueName]) {
		return true;
	}

	m_state[in_valueName] = in_value;
	return false;
	};

	var stateValueCmpColour4 = function stateValueCmpColour4(in_valueName, in_value) {
	if (in_valueName in m_state) {
		var stateValue = m_state[in_valueName];

		if (true === cmpAlmost$1(stateValue, in_value)) {
		return true;
		}
	}

	m_state[in_valueName] = in_value;
	return false;
	};

	var stateValueCmpVector4 = function stateValueCmpVector4(in_valueName, in_value) {
	if (in_valueName in m_state) {
		var stateValue = m_state[in_valueName];

		if (true === cmpAlmost$2(stateValue, in_value)) {
		return true;
		}
	}

	m_state[in_valueName] = in_value;
	return false;
	};

	var setTexture = function setTexture(in_index, in_textureOrUndefined) {
	if (false === stateValueCmp(sTextureStateName[in_index], in_textureOrUndefined)) {
		if (undefined !== in_textureOrUndefined) {
		in_textureOrUndefined.apply(m_webGLContextWrapper, in_index);
		} else {
		console.assert(false, "setTexture undefined:" + in_index);
		}
	}
	};

	var setTriangleCull = function setTriangleCull(in_enabled, in_cullFaceEnumName) {
	if (false === stateValueCmp("cullFaceEnabled", in_enabled)) {
		var enableCullFaceEnum = m_webGLContextWrapper.getEnum("CULL_FACE");

		if (true === in_enabled) {
		m_webGLContextWrapper.callMethod("enable", enableCullFaceEnum);
		} else {
		m_webGLContextWrapper.callMethod("disable", enableCullFaceEnum);
		}
	}

	if (true === in_enabled) {
		if (false === stateValueCmp("cullFaceEnum", in_cullFaceEnumName)) {
		var triangleCullEnum = m_webGLContextWrapper.getEnum(in_cullFaceEnumName);
		m_webGLContextWrapper.callMethod("cullFace", triangleCullEnum);
		}
	}

	return;
	};

	var setFrontFace = function setFrontFace(in_frontFaceEnumName) {
	if (false === stateValueCmp("frontFace", in_frontFaceEnumName)) {
		var frontFaceEnum = m_webGLContextWrapper.getEnum(in_frontFaceEnumName);
		m_webGLContextWrapper.callMethod("frontFace", frontFaceEnum);
	}

	return;
	};

	var setEnumEnabled = function setEnumEnabled(in_enabled, in_enum) {
	if (true === in_enabled) {
		m_webGLContextWrapper.callMethod("enable", in_enum);
	} else {
		m_webGLContextWrapper.callMethod("disable", in_enum);
	}
	};

	var setBlendMode = function setBlendMode(in_enabled, in_sourceBlendEnumName, in_destinationBlendEnumName) {
	if (false === stateValueCmp("blendModeEnabled", in_enabled)) {
		var enableBlendEnum = m_webGLContextWrapper.getEnum("BLEND");
		setEnumEnabled(in_enabled, enableBlendEnum);
	}

	if (false === stateValueCmp("blendFuncSource", in_sourceBlendEnumName) || false === stateValueCmp("blendFuncDestination", in_destinationBlendEnumName)) {
		var sourceBlendEnum = m_webGLContextWrapper.getEnum(in_sourceBlendEnumName);
		var destinationBlendEnum = m_webGLContextWrapper.getEnum(in_destinationBlendEnumName);
		m_webGLContextWrapper.callMethod("blendFunc", sourceBlendEnum, destinationBlendEnum);
	}

	return;
	};

	var setDepthFunc = function setDepthFunc(in_enabled, in_depthFuncEnumName) {
	if (false === stateValueCmp("depthFuncEnabled", in_enabled)) {
		var enableDepthTestEnum = m_webGLContextWrapper.getEnum("DEPTH_TEST");
		setEnumEnabled(in_enabled, enableDepthTestEnum);
	}

	if (false === stateValueCmp("depthFunc", in_depthFuncEnumName)) {
		var depthFuncEnum = m_webGLContextWrapper.getEnum(in_depthFuncEnumName);
		m_webGLContextWrapper.callMethod("depthFunc", depthFuncEnum);
	}

	return;
	};

	var setColorMask = function setColorMask(in_red, in_green, in_blue, in_alpha) {
	var falseColorMaskRed = stateValueCmp("colorMaskRed", in_red);
	var falseColorMaskGreen = stateValueCmp("colorMaskGreen", in_green);
	var falseColorMaskBlue = stateValueCmp("colorMaskBlue", in_blue);
	var falseColorMaskAlpha = stateValueCmp("colorMaskAlpha", in_alpha);

	if (false === falseColorMaskRed || false === falseColorMaskGreen || false === falseColorMaskBlue || false === falseColorMaskAlpha) {
		m_webGLContextWrapper.callMethod("colorMask", in_red, in_green, in_blue, in_alpha);
	}
	};

	var setDepthMask = function setDepthMask(in_depthMask) {
	if (false === stateValueCmp("depthMask", in_depthMask)) {
		m_webGLContextWrapper.callMethod("depthMask", in_depthMask);
	}
	};

	var setStencilMask = function setStencilMask(in_stencilMask) {
	if (false === stateValueCmp("stencilMask", in_stencilMask)) {
		m_webGLContextWrapper.callMethod("stencilMask", in_stencilMask);
	}
	};

	var that = Object.create({
	"addResourceContextCallbacks": function addResourceContextCallbacks(in_restoredCallback, in_lostCallback) {
		m_webGLContextWrapper.addResourceContextCallbacks(in_restoredCallback, in_lostCallback);
	},
	"removeResourceContextCallbacks": function removeResourceContextCallbacks(in_restoredCallback, in_lostCallback) {
		m_webGLContextWrapper.removeResourceContextCallbacks(in_restoredCallback, in_lostCallback);
	},
	"flush": function flush() {
		m_webGLContextWrapper.callMethod("flush");
		return;
	},
	"clear": function clear(in_colourOrUndefined, in_depthOrUndefined, in_stencilOrUndefined) {
		var clearFlag = 0;

		if (undefined !== in_colourOrUndefined) {
		clearFlag |= m_webGLContextWrapper.getEnum("COLOR_BUFFER_BIT");

		if (false === stateValueCmpColour4("clearColor", in_colourOrUndefined)) {
			m_webGLContextWrapper.callMethod("clearColor", in_colourOrUndefined.getRed(), in_colourOrUndefined.getGreen(), in_colourOrUndefined.getBlue(), in_colourOrUndefined.getAlpha());
		}
		}

		if (undefined !== in_depthOrUndefined) {
		clearFlag |= m_webGLContextWrapper.getEnum("DEPTH_BUFFER_BIT");

		if (false === stateValueCmp("clearDepth", in_depthOrUndefined)) {
			m_webGLContextWrapper.callMethod("clearDepth", in_depthOrUndefined);
		}
		}

		if (undefined !== in_stencilOrUndefined) {
		clearFlag |= m_webGLContextWrapper.getEnum("STENCIL_BUFFER_BIT");

		if (false === stateValueCmp("clearStencil", in_stencilOrUndefined)) {
			m_webGLContextWrapper.callMethod("clearStencil", in_stencilOrUndefined);
		}
		}

		if (0 !== clearFlag) {
		m_webGLContextWrapper.callMethod("clear", clearFlag);
		}

		return;
	},
	"resetRenderTarget": function resetRenderTarget() {
		var targetEnum = m_webGLContextWrapper.getEnum("FRAMEBUFFER");
		m_webGLContextWrapper.callMethod("bindFramebuffer", targetEnum, null);
		that.setViewport(0, 0, m_webGLContextWrapper.getCanvasWidth(), m_webGLContextWrapper.getCanvasHeight());
		return;
	},
	"applyRenderTarget": function applyRenderTarget(in_renderTarget) {
		if (undefined === in_renderTarget) {
		that.resetRenderTarget();
		return;
		}

		var targetEnum = m_webGLContextWrapper.getEnum("FRAMEBUFFER");
		var frameBufferObject = in_renderTarget.getFrameBufferObject();
		m_webGLContextWrapper.callMethod("bindFramebuffer", targetEnum, frameBufferObject);
		var width = in_renderTarget.getWidth();
		var height = in_renderTarget.getHeight();
		that.setViewport(0, 0, width, height);
		return;
	},
	"applyShader": function applyShader(in_shader, in_uniformServerOrUndefined) {
		var shaderProgramObject = in_shader.getShaderProgramObject();

		if (undefined !== shaderProgramObject) {
		m_webGLContextWrapper.callMethod("useProgram", shaderProgramObject);
		}

		var mapUniform = in_shader.getMapUniform();

		if (undefined !== in_uniformServerOrUndefined) {
		for (var key in mapUniform) {
			if (key in in_uniformServerOrUndefined) {
			var value = in_uniformServerOrUndefined[key];
			mapUniform[key].apply(m_webGLContextWrapper, value);
			}
		}
		}

		m_lastShaderMapVertexAttribute = in_shader.getMapVertexAttribute();
		return;
	},
	"applyMaterial": function applyMaterial(in_material) {
		var textureArray = in_material.getTextureArray();

		for (var index = 0; index < textureArray.length; ++index) {
		var texture = textureArray[index];
		setTexture(index, texture);
		}

		setFrontFace(in_material.getFrontFaceEnumName());
		setTriangleCull(in_material.getTriangleCullEnabled(), in_material.getTriangleCullEnumName());
		setBlendMode(in_material.getBlendModeEnabled(), in_material.getSourceBlendEnumName(), in_material.getDestinationBlendEnumName());
		setDepthFunc(in_material.getDepthFuncEnabled(), in_material.getDepthFuncEnumName());
		setColorMask(in_material.getColorMaskRed(), in_material.getColorMaskGreen(), in_material.getColorMaskBlue(), in_material.getColorMaskAlpha());
		setDepthMask(in_material.getDepthMask());
		setStencilMask(in_material.getStencilMask());
		return;
	},
	"drawModel": function drawModel(in_model, in_firstOrUndefined, in_countOrUndefined) {
		in_model.draw(m_webGLContextWrapper, m_lastShaderMapVertexAttribute, in_firstOrUndefined, in_countOrUndefined);
		return;
	},
	"setViewport": function setViewport(in_x, in_y, in_width, in_height) {
		var param = factoryInt32(in_x, in_y, in_width, in_height);

		if (false === stateValueCmpVector4("viewport", param)) {
		m_webGLContextWrapper.callMethod("viewport", in_x, in_y, in_width, in_height);
		}

		return;
	},
	"getViewport": function getViewport(in_vec4OrUndefined) {
		var viewportEnum = m_webGLContextWrapper.getEnum("VIEWPORT");
		var param = m_webGLContextWrapper.callMethod("getParameter", viewportEnum);
		var result;

		if (undefined !== param) {
		if (undefined !== in_vec4OrUndefined) {
			in_vec4OrUndefined.setX(param[0]);
			in_vec4OrUndefined.setY(param[1]);
			in_vec4OrUndefined.setZ(param[2]);
			in_vec4OrUndefined.setW(param[3]);
		}

		result = factoryInt32(param[0], param[1], param[2], param[3], m_state["viewport"]);
		m_state["viewport"] = result;
		}

		return result;
	},
	"createBuffer": function createBuffer() {
		var bufferHandle = m_webGLContextWrapper.callMethod("createBuffer");
		return bufferHandle;
	},
	"updateBuffer": function updateBuffer(in_bufferHandle, in_arrayData, in_bufferObjectTypeName, in_usageName) {
		var bufferObjectType = m_webGLContextWrapper.getEnum(in_bufferObjectTypeName);
		m_webGLContextWrapper.callMethod("bindBuffer", bufferObjectType, in_bufferHandle);
		var usage = m_webGLContextWrapper.getEnum(in_usageName);
		m_webGLContextWrapper.callMethod("bufferData", bufferObjectType, in_arrayData, usage);
		return;
	},
	"deleteBuffer": function deleteBuffer(in_bufferHandle) {
		m_webGLContextWrapper.callMethod("deleteBuffer", in_bufferHandle);
		return;
	},
	"getExtention": function getExtention(in_extentionName) {
		var result = m_webGLContextWrapper.callMethod("getExtension", in_extentionName);
		return result;
	},
	"getCanvasWidth": function getCanvasWidth() {
		return m_webGLContextWrapper.getCanvasWidth();
	},
	"getCanvasHeight": function getCanvasHeight() {
		return m_webGLContextWrapper.getCanvasHeight();
	},
	"destroy": function destroy() {
		m_webGLContextWrapper.removeResourceContextCallbacks(aquireWebGLResources, releaseWebGLResources);
	}
	});

	var aquireWebGLResources = function aquireWebGLResources() {
	m_state = {};
	m_lastShaderMapVertexAttribute = {};
	return;
	};

	var releaseWebGLResources = function releaseWebGLResources() {
	return;
	};

	m_webGLContextWrapper.addResourceContextCallbacks(aquireWebGLResources, releaseWebGLResources);
	return that;
}

function MaterialWrapperFactory (in_textureArrayOrUndefined, in_triangleCullEnabledOrUndefined, in_triangleCullEnumNameOrUndefined, in_blendModeEnabledOrUndefined, in_sourceBlendEnumNameOrUndefined, in_destinationBlendEnumNameOrUndefined, in_depthFuncEnabledOrUndefined, in_depthFuncEnumNameOrUndefined, in_frontFaceEnumNameOrUndefined, in_colorMaskRedOrUndefined, in_colorMaskGreenOrUndefined, in_colorMaskBlueOrUndefined, in_colorMaskAlphaOrUndefined, in_depthMaskOrUndefined, in_stencilMaskOrUndefined) {
	var result = Object.create({
	"getTextureArray": function getTextureArray() {
		if (undefined === in_textureArrayOrUndefined) {
		return [];
		}

		return in_textureArrayOrUndefined;
	},
	"setTextureArray": function setTextureArray(in_textureArray) {
		in_textureArrayOrUndefined = in_textureArray;
		return;
	},
	"getTriangleCullEnabled": function getTriangleCullEnabled() {
		if (undefined === in_triangleCullEnabledOrUndefined) {
		return false;
		}

		return in_triangleCullEnabledOrUndefined;
	},
	"getTriangleCullEnumName": function getTriangleCullEnumName() {
		if (undefined === in_triangleCullEnumNameOrUndefined) {
		return "BACK";
		}

		return in_triangleCullEnumNameOrUndefined;
	},
	"getBlendModeEnabled": function getBlendModeEnabled() {
		if (undefined === in_blendModeEnabledOrUndefined) {
		return false;
		}

		return in_blendModeEnabledOrUndefined;
	},
	"getSourceBlendEnumName": function getSourceBlendEnumName() {
		if (undefined === in_sourceBlendEnumNameOrUndefined) {
		return "ONE";
		}

		return in_sourceBlendEnumNameOrUndefined;
	},
	"getDestinationBlendEnumName": function getDestinationBlendEnumName() {
		if (undefined === in_destinationBlendEnumNameOrUndefined) {
		return "ZERO";
		}

		return in_destinationBlendEnumNameOrUndefined;
	},
	"getDepthFuncEnabled": function getDepthFuncEnabled() {
		if (undefined === in_depthFuncEnabledOrUndefined) {
		return false;
		}

		return in_depthFuncEnabledOrUndefined;
	},
	"getDepthFuncEnumName": function getDepthFuncEnumName() {
		if (undefined === in_depthFuncEnumNameOrUndefined) {
		return "LEQUAL";
		}

		return in_depthFuncEnumNameOrUndefined;
	},
	"getFrontFaceEnumName": function getFrontFaceEnumName() {
		if (undefined === in_frontFaceEnumNameOrUndefined) {
		return "CW";
		}

		return in_frontFaceEnumNameOrUndefined;
	},
	"getColorMaskRed": function getColorMaskRed() {
		if (undefined === in_colorMaskRedOrUndefined) {
		return true;
		}

		return in_colorMaskRedOrUndefined;
	},
	"setColorMaskRed": function setColorMaskRed(in_value) {
		in_colorMaskRedOrUndefined = in_value;
		return;
	},
	"getColorMaskGreen": function getColorMaskGreen() {
		if (undefined === in_colorMaskGreenOrUndefined) {
		return true;
		}

		return in_colorMaskGreenOrUndefined;
	},
	"setColorMaskGreen": function setColorMaskGreen(in_value) {
		in_colorMaskGreenOrUndefined = in_value;
		return;
	},
	"getColorMaskBlue": function getColorMaskBlue() {
		if (undefined === in_colorMaskBlueOrUndefined) {
		return true;
		}

		return in_colorMaskBlueOrUndefined;
	},
	"setColorMaskBlue": function setColorMaskBlue(in_value) {
		in_colorMaskBlueOrUndefined = in_value;
		return;
	},
	"getColorMaskAlpha": function getColorMaskAlpha() {
		if (undefined === in_colorMaskAlphaOrUndefined) {
		return false;
		}

		return in_colorMaskAlphaOrUndefined;
	},
	"setColorMaskAlpha": function setColorMaskAlpha(in_value) {
		in_colorMaskAlphaOrUndefined = in_value;
		return;
	},
	"getDepthMask": function getDepthMask() {
		if (undefined === in_depthMaskOrUndefined) {
		return false;
		}

		return in_depthMaskOrUndefined;
	},
	"getStencilMask": function getStencilMask() {
		if (undefined === in_stencilMaskOrUndefined) {
		return false;
		}

		return in_stencilMaskOrUndefined;
	}
	});
	return result;
}

function ModelWrapperFactory (in_webGLState, in_modeName, in_elementCount, in_mapDataStream, in_elementIndexOrUndefined) {
	var m_elementIndexOrUndefined = in_elementIndexOrUndefined;
	var m_elementIndexHandle = undefined;
	var m_elementByteSize = undefined;
	var m_elementType = undefined;
	var that = Object.create({
	"draw": function draw(in_webGLContextWrapper, in_mapVertexAttribute, in_firstOrUndefined, in_countOrUndefined) {
		setupDraw(in_webGLContextWrapper, in_mapVertexAttribute);
		internalDraw(in_webGLContextWrapper, in_firstOrUndefined, in_countOrUndefined);
		tearDownDraw(in_webGLContextWrapper, in_mapVertexAttribute);
		return;
	},
	"setElementCount": function setElementCount(in_newElementCount) {
		in_elementCount = in_newElementCount;
		return;
	},
	"getDataStream": function getDataStream(in_name) {
		if (in_name in in_mapDataStream) {
		return in_mapDataStream[in_name];
		}

		return undefined;
	},
	"destroy": function destroy() {
		in_webGLState.removeResourceContextCallbacks(aquireWebGLResources, releaseWebGLResources);

		for (var key in in_mapDataStream) {
		var dataStream = in_mapDataStream[key];
		dataStream.destroy();
		}

		return;
	}
	});

	var aquireWebGLResources = function aquireWebGLResources(in_webGLContextWrapper) {
	if (m_elementIndexOrUndefined instanceof Uint8Array) {
		m_elementByteSize = 1;
		m_elementType = in_webGLContextWrapper.getEnum("UNSIGNED_BYTE");
	} else if (m_elementIndexOrUndefined instanceof Uint16Array) {
		m_elementByteSize = 2;
		m_elementType = in_webGLContextWrapper.getEnum("UNSIGNED_SHORT");
	} else if (m_elementIndexOrUndefined instanceof Uint32Array) {
		m_elementByteSize = 4;
		m_elementType = in_webGLContextWrapper.getEnum("UNSIGNED_INT");
	}

	if (undefined !== m_elementIndexOrUndefined) {
		m_elementIndexHandle = in_webGLState.createBuffer();
		in_webGLState.updateBuffer(m_elementIndexHandle, m_elementIndexOrUndefined, "ELEMENT_ARRAY_BUFFER", "STATIC_DRAW");
	}

	return;
	};

	var releaseWebGLResources = function releaseWebGLResources() {
	if (undefined !== m_elementIndexOrUndefined) {
		in_webGLState.deleteBuffer(m_elementIndexHandle);
		m_elementIndexHandle = undefined;
	}

	m_elementByteSize = undefined;
	m_elementType = undefined;
	return;
	};

	var setupDraw = function setupDraw(in_webGLContextWrapper, in_mapVertexAttribute) {
	for (var key in in_mapVertexAttribute) {
		var position = in_mapVertexAttribute[key];

		if (!(key in in_mapDataStream) || -1 === position) {
		continue;
		}

		var dataStream = in_mapDataStream[key];
		dataStream.setupDraw(in_webGLContextWrapper, position);
	}

	if (undefined !== m_elementIndexHandle) {
		var bufferObjectType = in_webGLContextWrapper.getEnum("ELEMENT_ARRAY_BUFFER");
		in_webGLContextWrapper.callMethod("bindBuffer", bufferObjectType, m_elementIndexHandle);
	}
	};

	var internalDraw = function internalDraw(in_webGLContextWrapper, in_firstOrUndefined, in_countOrUndefined) {
	var first = undefined == in_firstOrUndefined ? 0 : in_firstOrUndefined;
	var count = undefined == in_countOrUndefined ? in_elementCount : in_countOrUndefined;
	var mode = in_webGLContextWrapper.getEnum(in_modeName);

	if (undefined === m_elementIndexHandle) {
		in_webGLContextWrapper.callMethod("drawArrays", mode, first, count);
	} else {
		in_webGLContextWrapper.callMethod("drawElements", mode, count, m_elementType, first * m_elementByteSize);
	}
	};

	var tearDownDraw = function tearDownDraw(in_webGLContextWrapper, in_mapVertexAttribute) {
	for (var key in in_mapVertexAttribute) {
		var position = in_mapVertexAttribute[key];
		if (!(key in in_mapDataStream) || -1 === position) continue;
		var dataStream = in_mapDataStream[key];
		dataStream.tearDownDraw(in_webGLContextWrapper, position);
	}
	};

	in_webGLState.addResourceContextCallbacks(aquireWebGLResources, releaseWebGLResources);
	return that;
}

function ModelDataStream (in_webGLState, in_typeName, in_elementsPerVertex, in_arrayData, in_usageName, in_normalise) {
	var m_bufferObject = undefined;
	var that = Object.create({
	"getVertexCount": function getVertexCount() {
		return in_arrayData.length / in_elementsPerVertex;
	},
	"updateData": function updateData(in_newArrayData) {
		in_arrayData = in_newArrayData;
		in_webGLState.updateBuffer(m_bufferObject, in_arrayData, "ARRAY_BUFFER", in_usageName);
		return;
	},
	"setupDraw": function setupDraw(in_webGLContextWrapper, in_position) {
		var bufferObjectType = in_webGLContextWrapper.getEnum("ARRAY_BUFFER");
		in_webGLContextWrapper.callMethod("bindBuffer", bufferObjectType, m_bufferObject);
		var stride = 0;
		var offset = 0;
		var type = in_webGLContextWrapper.getEnum(in_typeName);
		in_webGLContextWrapper.callMethod("vertexAttribPointer", in_position, in_elementsPerVertex, type, in_normalise, stride, offset);
		in_webGLContextWrapper.callMethod("enableVertexAttribArray", in_position);
	},
	"tearDownDraw": function tearDownDraw(in_webGLContextWrapper, in_position) {
		in_webGLContextWrapper.callMethod("disableVertexAttribArray", in_position);
	},
	"destroy": function destroy() {
		in_webGLState.removeResourceContextCallbacks(aquireWebGLResources, releaseWebGLResources);
		return;
	}
	});

	var aquireWebGLResources = function aquireWebGLResources() {
	m_bufferObject = in_webGLState.createBuffer();
	in_webGLState.updateBuffer(m_bufferObject, in_arrayData, "ARRAY_BUFFER", in_usageName);
	};

	var releaseWebGLResources = function releaseWebGLResources() {
	in_webGLState.deleteBuffer(m_bufferObject);
	m_bufferObject = undefined;
	};

	in_webGLState.addResourceContextCallbacks(aquireWebGLResources, releaseWebGLResources);
	return that;
}

var factory$3 = function factory(in_typeName, in_uniformHandle) {
	var result = Object.create({
	"apply": function apply(in_webGLContextWrapper, in_value) {
		in_webGLContextWrapper.callMethod(in_typeName, in_uniformHandle, in_value);
	}
	});
	return result;
};

function ShaderWrapper (in_webGLState, in_vertexShaderSource, in_fragmentShaderSource, in_vertexAttributeNameArrayOrUndefined, in_uniformNameNameTypeMapOrUndefined) {
	var m_shaderProgramObject = undefined;
	var m_vertexWebGLShader = undefined;
	var m_fragmentWebGLShader = undefined;
	var m_mapVertexAttribute = undefined;
	var m_mapUniform = undefined;
	var that = Object.create({
	"getMapVertexAttribute": function getMapVertexAttribute() {
		return m_mapVertexAttribute;
	},
	"getMapUniform": function getMapUniform() {
		return m_mapUniform;
	},
	"getShaderProgramObject": function getShaderProgramObject() {
		return m_shaderProgramObject;
	},
	"destroy": function destroy() {
		in_webGLState.removeResourceContextCallbacks(restoredCallback, lostCallback);
	}
	});

	var restoredCallback = function restoredCallback(in_webGLContextWrapper) {
	var vertexShaderEnum = in_webGLContextWrapper.getEnum("VERTEX_SHADER");
	m_vertexWebGLShader = loadShader(in_webGLContextWrapper, in_vertexShaderSource, vertexShaderEnum);
	var fragmentShaderEnum = in_webGLContextWrapper.getEnum("FRAGMENT_SHADER");
	m_fragmentWebGLShader = loadShader(in_webGLContextWrapper, in_fragmentShaderSource, fragmentShaderEnum);
	m_shaderProgramObject = linkProgram(in_webGLContextWrapper, m_vertexWebGLShader, m_fragmentWebGLShader);
	return;
	};

	var lostCallback = function lostCallback(in_webGLContextWrapper) {
	m_mapVertexAttribute = undefined;
	m_mapUniform = undefined;

	if (undefined !== m_vertexWebGLShader) {
		in_webGLContextWrapper.callMethod("deleteShader", m_vertexWebGLShader);
		m_vertexWebGLShader = undefined;
	}

	if (undefined !== m_fragmentWebGLShader) {
		in_webGLContextWrapper.callMethod("deleteShader", m_fragmentWebGLShader);
		m_fragmentWebGLShader = undefined;
	}

	if (undefined !== m_shaderProgramObject) {
		in_webGLContextWrapper.callMethod("deleteProgram", m_shaderProgramObject);
		m_shaderProgramObject = undefined;
	}

	return;
	};

	var loadShader = function loadShader(in_webGLContextWrapper, in_shaderText, in_type) {
	var shaderHandle = in_webGLContextWrapper.callMethod("createShader", in_type);

	if (0 === shaderHandle) {
		return undefined;
	}

	in_webGLContextWrapper.callMethod("shaderSource", shaderHandle, in_shaderText);
	in_webGLContextWrapper.callMethod("compileShader", shaderHandle);
	var compileStatusEnum = in_webGLContextWrapper.getEnum("COMPILE_STATUS");
	var compiled = in_webGLContextWrapper.callMethod("getShaderParameter", shaderHandle, compileStatusEnum);
	var errorInfo = "";

	if (!compiled) {
		errorInfo = in_webGLContextWrapper.callMethod("getShaderInfoLog", shaderHandle);
		in_webGLContextWrapper.callMethod("deleteShader", shaderHandle);
		shaderHandle = undefined;
	}

	if (undefined === shaderHandle) {
		alert("Error creating shader: " + errorInfo);
	}

	return shaderHandle;
	};

	var linkProgram = function linkProgram(in_webGLContextWrapper, in_vertexWebGLShader, in_fragmentWebGLShader) {
	var programHandle = in_webGLContextWrapper.callMethod("createProgram");

	if (0 === programHandle || undefined === programHandle) {
		return undefined;
	}

	in_webGLContextWrapper.callMethod("attachShader", programHandle, in_vertexWebGLShader);
	in_webGLContextWrapper.callMethod("attachShader", programHandle, in_fragmentWebGLShader);

	if (undefined !== in_uniformNameNameTypeMapOrUndefined) {
		var index = 0;

		for (var name in in_uniformNameNameTypeMapOrUndefined) {
		in_webGLContextWrapper.callMethod("bindAttribLocation", programHandle, index, name);
		index += 1;
		}
	}

	in_webGLContextWrapper.callMethod("linkProgram", programHandle);
	var linkStatusEnum = in_webGLContextWrapper.getEnum("LINK_STATUS");
	var linked = in_webGLContextWrapper.callMethod("getProgramParameter", programHandle, linkStatusEnum);

	if (!linked) {
		var errorInfo = in_webGLContextWrapper.callMethod("getProgramInfoLog", programHandle);
		alert("Error linking program: " + errorInfo);
		in_webGLContextWrapper.callMethod("deleteProgram", programHandle);
		return undefined;
	}

	m_mapVertexAttribute = {};

	if (undefined !== in_vertexAttributeNameArrayOrUndefined) {
		for (var index = 0; index < in_vertexAttributeNameArrayOrUndefined.length; ++index) {
		var key = in_vertexAttributeNameArrayOrUndefined[index];
		m_mapVertexAttribute[key] = in_webGLContextWrapper.callMethod("getAttribLocation", programHandle, key);
		}
	}

	m_mapUniform = {};

	if (undefined !== in_uniformNameNameTypeMapOrUndefined) {
		for (var name in in_uniformNameNameTypeMapOrUndefined) {
		var typeName = in_uniformNameNameTypeMapOrUndefined[name];
		var location = in_webGLContextWrapper.callMethod("getUniformLocation", programHandle, name);
		m_mapUniform[name] = factory$3(typeName, location);
		}
	}

	return programHandle;
	};

	in_webGLState.addResourceContextCallbacks(restoredCallback, lostCallback);
	return that;
}

var sVertexShader = "\nattribute vec2 a_position;\nvoid main() {\n\tgl_Position = vec4(a_position.x, a_position.y, 0.0, 1.0);\n}\n";
var sFragmentShader = "\nprecision mediump float;\nvoid main() {\n\tgl_FragColor = vec4(0.0,1.0,0.0,1.0);\n}\n";
var sVertexAttributeNameArray = ["a_position"];
function triangle () {
	var html5CanvasWrapper = factoryAppendBody(document, {
	"width": "512px",
	"height": "512px",
	"backgroundColor": "#FFFFFF",
	"margin": "0",
	"padding": "0",
	"display": "block"
	});
	var webGLState = WebGLStateFactory(html5CanvasWrapper.getElement(), false);
	webGLState.clear(factoryFloat32(1.0, 0.0, 0.0));
	var model = ModelWrapperFactory(webGLState, "TRIANGLES", 3, {
	"a_position": ModelDataStream(webGLState, "BYTE", 2, new Int8Array([-1, -1, -1, 1, 1, -1]), "STATIC_DRAW", false)
	});
	var material = MaterialWrapperFactory();
	var shader = ShaderWrapper(webGLState, sVertexShader, sFragmentShader, sVertexAttributeNameArray);
	webGLState.applyShader(shader);
	webGLState.applyMaterial(material);
	webGLState.drawModel(model);
	return;
}

function onPageLoad(){
	console.log("onPageLoad");
	var canvas = document.getElementById("myCanvas");

	var webGLState = WebGLStateFactory(canvas, false);
	webGLState.clear(factoryFloat32(1.0, 0.0, 0.0));
	var model = ModelWrapperFactory(webGLState, "TRIANGLES", 3, {
	"a_position": ModelDataStream(webGLState, "BYTE", 2, new Int8Array([-1, -1, -1, 1, 1, -1]), "STATIC_DRAW", false)
	});
	var material = MaterialWrapperFactory();
	var shader = ShaderWrapper(webGLState, sVertexShader, sFragmentShader, sVertexAttributeNameArray);
	webGLState.applyShader(shader);
	webGLState.applyMaterial(material);
	webGLState.drawModel(model);

}
		</script>
	</head>
	<body>
		<svg xmlns="http://www.w3.org/2000/svg"
			fill="none"
			style="position:fixed; top:0; left:0; height:100%; width:100%;"
			>
			<!-- preserveAspectRatio="xMidYMid meet" -->
			<svg id="topmiddle" style="overflow: visible" x="50%" y="0%">
				<circle r="50" cx="0" cy="50" fill="red" />
			</svg>
			<svg id="middleright" style="overflow: visible" x="100%" y="50%">
				<circle r="50" cx="-50" cy="0" fill="green" />
			</svg>
			<svg id="bottommiddle" style="overflow: visible" x="50%" y="100%">
				<circle r="50" cx="0" cy="-50" fill="blue" />
			</svg>
			<svg id="middleleft" style="overflow: visible" x="0%" y="50%">
				<circle r="50" cx="50" cy="0" fill="yellow" />
			</svg>
		</svg>

		<canvas id="myCanvas" 
			style="top:0; left:0; height:100%; width:100%; background:#00FF00";
			width="100%" 
			height="100%" >
		</canvas>

		<script >window.addEventListener('load', onPageLoad, true);</script>
	</body>
</html>